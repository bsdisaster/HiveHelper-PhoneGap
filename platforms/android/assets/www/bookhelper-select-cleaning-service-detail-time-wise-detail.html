<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <title>Book helper select cleaning service time wise detail for pay - Hive Helper 1.0</title>

    <link rel="stylesheet" type="text/css" href="styles/style.css">
    <link rel="stylesheet" type="text/css" href="styles/skin.css">
    <link rel="stylesheet" type="text/css" href="styles/framework.css">
    <link rel="stylesheet" type="text/css" href="styles/ionicons.min.css">

    <script type="text/javascript" src="scripts/jquery.js"></script>
    <script type="text/javascript" src="scripts/plugins.js"></script>
    <script type="text/javascript" src="scripts/custom.js"></script>
    <script type="text/javascript" src="scripts/setup_baseurl.js"></script>
    <script type="text/javascript" src="cordova.js"></script>

</head>

<body>
    <div id="page-transitions">
        <div class="header header-logo-center header-light">
            <a href="#" class="header-icon header-icon-5" target="_self">
                <img src="images/back_arrow.png" height="20" />
            </a>
            <a href="dashboard.html" target="_self" class="header-logo"></a>
            <a href="dashboard.html" class="header-icon header-icon-4" target="_self">
                <img src="images/home-icon.png" height="20" />
            </a>
        </div>
        <div id="page-content" class="page-content">
            <div id="page-content-scroll" class="header-clear">
                <!--Enables this element to be scrolled -->
                <div class="heading-strip heading-strip-fix-padding">
                    <h3 class="center-text color-black">Details</h3>
                </div>

                <div class="decoration decoration-margins"></div>

                <div class="content" id="DivQuestionsAnswer">
                    <div id="dvChangeDateTime" align="center" style="display:none">
                        <a href="bookhelper-select-cleaning-service-detail.html?editAppointment=true" target="_self">Change Date Time</a>
                    </div>
                </div>
            </div>
            <a href="#" class="back-to-top-badge"><i class="ion-ios-arrow-up"></i></a>
        </div>

        <script type="text/javascript">
            $(document).ready(function () {

            }).on('deviceready', function () {
                document.addEventListener("deviceready", getServiceQuestions, false);
            });

            function getParameterByName(name, url) {
                if (!url) url = window.location.href;
                name = name.replace(/[\[\]]/g, "\\$&");
                var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                    results = regex.exec(url);
                if (!results) return null;
                if (!results[2]) return '';
                return decodeURIComponent(results[2].replace(/\+/g, " "));
            }

            function getServiceQuestions() {

                if (getParameterByName("editAppointment")) {
                    window.plugins.spinnerDialog.show("Please wait...", "Loading...", true);

                    $(".header-icon-5").attr("href", "my-booking.html");

                    $.ajax({
                        url: api_baseUrl + 'appointment/getQuestionAnswer/' + localStorage.getItem("appointmentId"),
                        type: "GET",
                        dataType: "JSON",
                        success: function (response) {
                            // Inserting html into the result div on success
                            window.plugins.spinnerDialog.hide();
                            if (response !== null && response.status === 1) {
                                $("#dvChangeDateTime").show();

                                var serviceQuestionsData = response.data.serviceQuestions;
                                if (serviceQuestionsData != null && serviceQuestionsData.length > 0) {
                                    var counter = 0;
                                    for (var i = 0; i < serviceQuestionsData.length; i++) {

                                        var html = '';
                                        counter++;
                                        if (serviceQuestionsData[i].fieldTypeId == "1") {

                                            var answer = serviceQuestionsData[i].answer;
                                            if (answer == null || answer == "undefined") {
                                                answer = "";
                                            }
                                            html = html + '<div style="padding-left: inherit" class="input-icon"><label id="questionTitle' + counter + '" data-val="' + serviceQuestionsData[i].serviceQuestionId + '" class="bold">' + serviceQuestionsData[i].questionTitle + '</label></div>';

                                            html = html + '<div class="input-icon"><input id="inputAnswer' + counter + '" type="text" class="input-text-box input-green-border" placeholder="Answer" value="' + answer + '"></div>';
                                        }
                                        else if (serviceQuestionsData[i].fieldTypeId == "2") {
                                            var answer = serviceQuestionsData[i].answer;
                                            if (answer == null || answer == "undefined") {
                                                answer = "";
                                            }

                                            html = html + '<div style="padding-left: inherit" class="input-icon"><label id="questionTitle' + counter + '" data-val="' + serviceQuestionsData[i].serviceQuestionId + '" class="bold">' + serviceQuestionsData[i].questionTitle + '</label></div>';

                                            html = html + '<div class="input-icon"><textarea id="inputDescription' + counter + '" class="contactTextarea" style="background:lightgray; width:100%; min-height: 120px; height:auto;">' + answer + '</textarea></div>';
                                        }
                                        else if (serviceQuestionsData[i].fieldTypeId == "3") {
                                            html = html + '<div style="padding-left: inherit" class="input-icon"><label id="questionTitle' + counter + '" data-val="' + serviceQuestionsData[i].serviceQuestionId + '" class="bold">' + serviceQuestionsData[i].questionTitle + '</label></div>';

                                            html = html + '<div class="one-half last-column" style="padding-left: inherit"><div class="extra-margin" id="checkbox' + counter + '">';
                                            for (var j = 0; j < serviceQuestionsData[i].options.length; j++) {
                                                html = html + '<div class="fac fac-checkbox fac-default"><span></span><input id="checkbox' + serviceQuestionsData[i].options[j].serviceQuestionOptionId + '" type="checkbox" value="' + serviceQuestionsData[i].options[j].serviceQuestionOptionId + '" data-checked ="' + serviceQuestionsData[i].options[j].isanswer + '"><label for="checkbox' + serviceQuestionsData[i].options[j].serviceQuestionOptionId + '">' + serviceQuestionsData[i].options[j].optionTitle + '</label></div>';
                                            }
                                            html = html + '</div></div>';

                                        }
                                        else if (serviceQuestionsData[i].fieldTypeId == "4") {
                                            html = html + '<div style="padding-left: inherit" class="input-icon"><label id="questionTitle' + counter + '" data-val="' + serviceQuestionsData[i].serviceQuestionId + '" class="bold">' + serviceQuestionsData[i].questionTitle + '</label></div>';

                                            html = html + '<div class="select-box-light">';
                                            html = html + '<select id="drpAnswer' + counter + '">';
                                            for (var j = 0; j < serviceQuestionsData[i].options.length; j++) {
                                                html = html + '<option value="' + serviceQuestionsData[i].options[j].serviceQuestionOptionId + '" data-checked ="' + serviceQuestionsData[i].options[j].isanswer + '">' + serviceQuestionsData[i].options[j].optionTitle + '</option>';
                                            }

                                            html = html + '</select>';
                                            html = html + '</div>';
                                        }
                                        html = html + '<div class="clear"></div>';
                                        $("#DivQuestionsAnswer").append(html);
                                    }
                                    $("#DivQuestionsAnswer").append('<div class="clear"></div>');
                                    $("#DivQuestionsAnswer").append('<button class="button button-blue button-full half-top full-bottom" onclick="updateDateTime()">Update</button>');

                                    localStorage.setItem("editAppointmentArray", JSON.stringify(serviceQuestionsData));
                                    getSelectedAnswers();
                                } else {
                                    navigator.notification.alert('No records found!', null, 'Warning', 'Close');
                                    window.location.href = "my-booking.html";
                                }
                            }
                            else {
                                navigator.notification.alert(response.message, null, 'Warning', 'Close');
                            }
                        },
                        error: function (jqXHR, text, error) {
                            // Displaying if there are any errors
                            window.plugins.spinnerDialog.hide();

                            if (error == null || error == "") {
                                navigator.notification.alert("It looks like you're offline.!", null, 'Error', 'Close');

                            } else {
                                navigator.notification.alert(error, null, 'Error', 'Close');
                            }
                        }
                    });
                }
                else {

                    window.plugins.spinnerDialog.show("Please wait...", "Loading...", true);
                    $(".header-icon-5").attr("href", "bookhelper-select-cleaning-service-detail.html");
                    var parameter = { "serviceId": localStorage.getItem("serviceId"), "franchiseId": localStorage.getItem("franchiseId") };

                    $.ajax({
                        url: api_baseUrl + 'Servicedetails/serviceQuestions/',
                        type: "POST",
                        data: JSON.stringify(parameter),
                        dataType: "JSON",
                        success: function (response) {
                            // Inserting html into the result div on success
                            window.plugins.spinnerDialog.hide();
                            if (response !== null && response.status === 1) {

                                var serviceQuestionsData = response.data;
                                if (serviceQuestionsData.length > 0) {
                                    var counter = 0;
                                    for (var i = 0; i < serviceQuestionsData.length; i++) {

                                        var html = '';
                                        counter++;

                                        if (serviceQuestionsData[i].fieldTypeId == "1") {
                                            html = html + '<div style="padding-left: inherit" class="input-icon"><label id="questionTitle' + counter + '" data-val="' + serviceQuestionsData[i].serviceQuestionId + '" class="bold">' + serviceQuestionsData[i].questionTitle + '</label></div>';

                                            html = html + '<div class="input-icon" style="padding-left: inherit"><input id="inputAnswer' + counter + '" type="text" class="input-text-box input-green-border" placeholder="Answer"></div>';
                                        }
                                        else if (serviceQuestionsData[i].fieldTypeId == "2") {
                                            html = html + '<div style="padding-left: inherit" class="input-icon"><label id="questionTitle' + counter + '" data-val="' + serviceQuestionsData[i].serviceQuestionId + '" class="bold">' + serviceQuestionsData[i].questionTitle + '</label></div>';

                                            html = html + '<div class="input-icon" style="padding-left: inherit"><textarea id="inputDescription' + counter + '" class="contactTextarea" style="background:lightgray; width:100%; min-height: 120px; height:auto;"></textarea></div>';
                                        }
                                        else if (serviceQuestionsData[i].fieldTypeId == "3") {
                                            html = html + '<div style="padding-left: inherit" class="input-icon"><label id="questionTitle' + counter + '" data-val="' + serviceQuestionsData[i].serviceQuestionId + '" class="bold">' + serviceQuestionsData[i].questionTitle + '</label></div>';

                                            html = html + '<div class="one-half last-column" style="padding-left: inherit"><div class="extra-margin" id="checkbox' + counter + '">';
                                            for (var j = 0; j < serviceQuestionsData[i].options.length; j++) {
                                                html = html + '<div class="fac fac-checkbox fac-default"><span></span><input id="checkbox' + serviceQuestionsData[i].options[j].serviceQuestionOptionId + '" type="checkbox" value="' + serviceQuestionsData[i].options[j].serviceQuestionOptionId + '"><label for="checkbox' + serviceQuestionsData[i].options[j].serviceQuestionOptionId + '">' + serviceQuestionsData[i].options[j].optionTitle + '</label></div>';
                                            }
                                            html = html + '</div></div>';

                                        }
                                        else if (serviceQuestionsData[i].fieldTypeId == "4") {
                                            html = html + '<div style="padding-left: inherit" class="input-icon"><label id="questionTitle' + counter + '" data-val="' + serviceQuestionsData[i].serviceQuestionId + '" class="bold">' + serviceQuestionsData[i].questionTitle + '</label></div>';

                                            html = html + '<div class="select-box-light">';
                                            html = html + '<select id="drpAnswer' + counter + '">';
                                            for (var j = 0; j < serviceQuestionsData[i].options.length; j++) {
                                                html = html + '<option value="' + serviceQuestionsData[i].options[j].serviceQuestionOptionId + '">' + serviceQuestionsData[i].options[j].optionTitle + '</option>';
                                            }
                                            html = html + '</select>';
                                            html = html + '</div>';
                                        }
                                        html = html + '<div class="clear"></div>';
                                        $("#DivQuestionsAnswer").append(html);
                                    }
                                    $("#DivQuestionsAnswer").append('<div class="clear"></div>');
                                    $("#DivQuestionsAnswer").append('<button onclick="paymentTempArray()" class="button button-blue button-full half-top full-bottom">Pay Now</button>');
                                    localStorage.setItem("appointmentArray", JSON.stringify(serviceQuestionsData));
                                }
                            }
                            else {
                                navigator.notification.alert(response.message, null, 'Warning', 'Close');
                            }
                        },
                        error: function (jqXHR, text, error) {
                            // Displaying if there are any errors
                            window.plugins.spinnerDialog.hide();

                            if (error == null || error == "") {
                                navigator.notification.alert("It looks like you're offline.!", null, 'Error', 'Close');

                            } else {
                                navigator.notification.alert(error, null, 'Error', 'Close');
                            }
                        }
                    });
                }
            }

            function getSelectedAnswers() {
                $("input[type=checkbox]").each(function () {
                    if ($(this).attr("data-checked") == "1") {
                        $(this).attr("checked", true);
                    }
                })

                $("select option").each(function () {
                    if ($(this).attr("data-checked") == "1") {
                        $(this).attr("selected", true);
                    }
                })
            }

            function convertTimeformat(format, time) {
                var hours = Number(time.match(/^(\d+)/)[1]);
                var minutes = Number(time.match(/:(\d+)/)[1]);
                var AMPM = time.match(/\s(.*)$/)[1];
                if ((AMPM == "pm" || AMPM == "PM") && hours < 12) hours = hours + 12;
                if ((AMPM == "am" || AMPM == "AM") && hours == 12) hours = hours - 12;
                var sHours = hours.toString();
                var sMinutes = minutes.toString();
                if (hours < 10) sHours = "0" + sHours;
                if (minutes < 10) sMinutes = "0" + sMinutes;
                return (sHours + ":" + sMinutes).toString();
            }

            function updateDateTime() {

                var arrayObject = [];
                var questionsArray = JSON.parse(localStorage.getItem("editAppointmentArray"));
                localStorage.removeItem("editAppointmentArray");

                for (var i = 0; i < questionsArray.length; i++) {

                    if (questionsArray[i].fieldTypeId == "1") {
                        var innerObject = {};

                        innerObject.serviceQuestionId = $("#questionTitle" + (i + 1)).attr("data-val");
                        innerObject.answer = $("#inputAnswer" + (i + 1)).val();
                        innerObject.option = [];

                        arrayObject.push(innerObject);
                    }
                }
                for (var i = 0; i < questionsArray.length; i++) {
                    if (questionsArray[i].fieldTypeId == "2") {
                        var innerObject = {};
                        innerObject.serviceQuestionId = $("#questionTitle" + (i + 1)).attr("data-val");
                        innerObject.answer = $("#inputDescription" + (i + 1)).val();
                        innerObject.option = [];

                        arrayObject.push(innerObject);
                    }
                }
                for (var i = 0; i < questionsArray.length; i++) {
                    if (questionsArray[i].fieldTypeId == "3") {
                        var innerObject = {};
                        innerObject.serviceQuestionId = $("#questionTitle" + (i + 1)).attr("data-val");
                        var checkedValues = $("#checkbox" + (i + 1)).find("input:checkbox:checked").map(function () {
                            return { "optionid": this.value };
                        }).get();
                        innerObject.option = checkedValues;

                        arrayObject.push(innerObject);
                    }
                }
                for (var i = 0; i < questionsArray.length; i++) {
                    if (questionsArray[i].fieldTypeId == "4") {
                        var innerObject = {};
                        innerObject.serviceQuestionId = $("#questionTitle" + (i + 1)).attr("data-val");
                        innerObject.option = [{ "optionid": $("#drpAnswer" + (i + 1)).val() }];

                        arrayObject.push(innerObject);
                    }
                }

                var helperSelectedTime = localStorage.getItem("helperSelectedTime");

                var parameter = {
                    "appointmentid": localStorage.getItem("appointmentId"),
                    "helperId": localStorage.getItem("helperId"),
                    "appointmentdate": localStorage.getItem("providerDate"),
                    "appointmentFrom": convertTimeformat("24", helperSelectedTime.split('-')[0]),
                    "appointmentTo": convertTimeformat("24", helperSelectedTime.split('-')[1]),
                    "QuestionAnswer": arrayObject
                };

                window.plugins.spinnerDialog.show("Please wait...", "Loading...", true);

                $.ajax({
                    url: api_baseUrl + 'Appointment/editAppointment/',
                    type: "POST",
                    data: JSON.stringify(parameter),
                    success: function (response) {
                        // Inserting html into the result div on success
                        window.plugins.spinnerDialog.hide();
                        if (response !== null && response.status === 1) {
                            navigator.notification.alert("Your data successfully updated.!", null, 'Success', 'Close');
                            window.location.href = "my-booking.html";
                        }
                        else {
                            navigator.notification.alert(response.message, null, 'Warning', 'Close');
                        }
                    },
                    error: function (jqXHR, text, error) {

                        window.plugins.spinnerDialog.hide();

                        if (error == null || error == "") {
                            navigator.notification.alert("It looks like you're offline.!", null, 'Error', 'Close');

                        } else {
                            navigator.notification.alert(error, null, 'Error', 'Close');
                        }
                    }
                });
            }

            function paymentTempArray() {

                var arrayObject = [];
                var questionsArray = JSON.parse(localStorage.getItem("appointmentArray"));
                localStorage.removeItem("appointmentArray");

                for (var i = 0; i < questionsArray.length; i++) {

                    if (questionsArray[i].fieldTypeId == "1") {
                        var innerObject = {};

                        innerObject.serviceQuestionId = $("#questionTitle" + (i + 1)).attr("data-val");
                        innerObject.userId = localStorage.getItem("userId");
                        innerObject.answer = $("#inputAnswer" + (i + 1)).val();
                        innerObject.option = [];

                        arrayObject.push(innerObject);
                    }
                }

                for (var i = 0; i < questionsArray.length; i++) {
                    if (questionsArray[i].fieldTypeId == "2") {
                        var innerObject = {};
                        innerObject.serviceQuestionId = $("#questionTitle" + (i + 1)).attr("data-val");
                        innerObject.userId = localStorage.getItem("userId");
                        innerObject.answer = $("#inputDescription" + (i + 1)).val();
                        innerObject.option = [];

                        arrayObject.push(innerObject);
                    }
                }
                for (var i = 0; i < questionsArray.length; i++) {
                    if (questionsArray[i].fieldTypeId == "3") {
                        var innerObject = {};
                        innerObject.serviceQuestionId = $("#questionTitle" + (i + 1)).attr("data-val");
                        innerObject.userId = localStorage.getItem("userId");
                        var checkedValues = $("#checkbox" + (i + 1)).find("input:checkbox:checked").map(function () {
                            return { "optionid": this.value };
                        }).get();
                        innerObject.option = checkedValues;

                        arrayObject.push(innerObject);
                    }
                }
                for (var i = 0; i < questionsArray.length; i++) {
                    if (questionsArray[i].fieldTypeId == "4") {
                        var innerObject = {};
                        innerObject.serviceQuestionId = $("#questionTitle" + (i + 1)).attr("data-val");
                        innerObject.userId = localStorage.getItem("userId");
                        innerObject.option = [{ "optionid": $("#drpAnswer" + (i + 1)).val() }];

                        arrayObject.push(innerObject);
                    }
                }

                localStorage.setItem("paymentTempObject", JSON.stringify(arrayObject));
                window.location.href = "hive-helper-payment.html";
            }

        </script>
    </div>
</body>
</html>